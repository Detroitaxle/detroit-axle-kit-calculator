<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Detroit Axle Kit Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; background: #f9f9f9; }
    table { border-collapse: collapse; width: 100%; background: #fff; box-shadow: 0 0 10px #eee; }
    th, td { padding: 8px 12px; border: 1px solid #ccc; text-align: center; }
    th { background: #eee; }
    .input-field { width: 70px; padding: 4px; font-size: 1em; }
    .checkbox-container { display: flex; align-items: center; justify-content: center; }
    .refund-value { font-weight: 600; color: green; }
  </style>
</head>
<body>
  <h2>Detroit Axle Kit Calculator</h2>
  <div id="partsContainer"></div>

  <script>
    class Calculator {
      constructor(parts) {
        this.parts = parts;
        this.renderPartsTable();
      }

      renderPartsTable() {
        let tableHTML = `
          <table>
            <thead>
              <tr>
                <th>Qty</th>
                <th>Description</th>
                <th>Part #</th>
                <th>Unit Price</th>
                <th>Returned</th>
                <th>Refund</th>
                <th>Return All</th>
              </tr>
            </thead>
            <tbody>
        `;

        this.parts.forEach((part, index) => {
          tableHTML += `
            <tr data-index="${index}">
              <td><input type="number" class="input-field qty-input" value="${part.qty}" min="0"></td>
              <td>${part.desc}</td>
              <td>${part.partNum ? part.partNum : 'â€”'}</td>
              <td><input type="number" class="input-field price-input" value="${part.price}" min="0" step="0.01"></td>
              <td>
                <input type="number" class="input-field returned-input" value="${part.returned}" min="0" max="${part.qty}">
              </td>
              <td class="refund-value">$0.00</td>
              <td class="checkbox-container">
                <input type="checkbox" class="returned-checkbox" ${part.isReturned ? 'checked' : ''}>
              </td>
            </tr>
          `;
        });

        tableHTML += `</tbody></table>`;
        document.getElementById("partsContainer").innerHTML = tableHTML;
        this.attachEvents();
        this.calculateRefunds();
      }

      attachEvents() {
        const rows = document.querySelectorAll("#partsContainer tbody tr");
        rows.forEach(row => {
          const index = Number(row.getAttribute("data-index"));
          const returnedInput = row.querySelector('.returned-input');
          const checkbox = row.querySelector('.returned-checkbox');
          const qtyInput = row.querySelector('.qty-input');
          const priceInput = row.querySelector('.price-input');

          // Qty change updates max for returned
          qtyInput.addEventListener('input', () => {
            const newQty = parseInt(qtyInput.value) || 0;
            this.parts[index].qty = newQty;
            returnedInput.max = newQty;
            if (parseInt(returnedInput.value) > newQty) returnedInput.value = newQty;
            this.calculateRefunds();
          });

          // Price change
          priceInput.addEventListener('input', () => {
            this.parts[index].price = parseFloat(priceInput.value) || 0;
            this.calculateRefunds();
          });

          // Returned input logic
          returnedInput.addEventListener('input', () => {
            let val = parseInt(returnedInput.value) || 0;
            const max = parseInt(returnedInput.max);
            if (val > max) val = max;
            if (val < 0) val = 0;
            this.parts[index].returned = val;

            if (val === max) {
              checkbox.checked = true;
              this.parts[index].isReturned = true;
            } else if (val === 0) {
              checkbox.checked = false;
              this.parts[index].isReturned = false;
            } else {
              checkbox.checked = false;
              this.parts[index].isReturned = false;
            }
            this.calculateRefunds();
          });

          // Checkbox logic
          checkbox.addEventListener('change', () => {
            if (checkbox.checked) {
              returnedInput.value = this.parts[index].qty;
              this.parts[index].returned = this.parts[index].qty;
              this.parts[index].isReturned = true;
            } else {
              returnedInput.value = 0;
              this.parts[index].returned = 0;
              this.parts[index].isReturned = false;
            }
            this.calculateRefunds();
          });
        });
      }

      calculateRefunds() {
        const rows = document.querySelectorAll("#partsContainer tbody tr");
        this.parts.forEach((part, idx) => {
          const refundCell = rows[idx].querySelector('.refund-value');
          const refunded = Math.min(part.returned, part.qty) * part.price;
          refundCell.textContent = `$${refunded.toFixed(2)}`;
        });
      }
    }

    // Example data
    const parts = [
      { qty: 5, desc: "Brake Pads", partNum: "BP123", price: 20.00, returned: 0, isReturned: false },
      { qty: 2, desc: "Rotors", partNum: "RT456", price: 45.00, returned: 0, isReturned: false },
      { qty: 1, desc: "Caliper", partNum: "CL789", price: 70.00, returned: 0, isReturned: false }
    ];

    // Initialize calculator
    new Calculator(parts);
  </script>
</body>
</html>
