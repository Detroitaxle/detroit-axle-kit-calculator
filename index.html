<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Detroit Axle Kit Calculator</title>
  <style>
    :root {
      --bg-primary: #121212;
      --bg-secondary: #1e1e1e;
      --bg-tertiary: #252525;
      --text-primary: #e0e0e0;
      --text-secondary: #a0a0a0;
      --accent: #ff7700;
      --accent-dark: #e06500;
      --border: #333;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background-color: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.4;
      padding: 16px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }

    .header h1 {
      font-size: 1.8rem;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .header p {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .main-layout {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 16px;
      margin-bottom: 16px;
    }

    .panel {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 16px;
    }

    .panel-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 16px;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .panel-title::before {
      content: "â€¢";
      color: var(--accent);
    }

    .form-group {
      margin-bottom: 16px;
    }

    .form-label {
      display: block;
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-bottom: 6px;
    }

    .kit-textarea {
      width: 100%;
      min-height: 120px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 10px;
      color: var(--text-primary);
      font-family: monospace;
      font-size: 0.9rem;
      resize: vertical;
    }

    .kit-textarea:focus {
      outline: none;
      border-color: var(--accent);
    }

    .price-input-wrapper {
      display: flex;
      align-items: center;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 8px 12px;
    }

    .price-icon {
      color: var(--accent);
      margin-right: 8px;
    }

    .price-input {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 1rem;
    }

    .price-input:focus {
      outline: none;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    .stat-item {
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 12px;
      text-align: center;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 0.75rem;
      margin-bottom: 4px;
    }

    .stat-value {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .stat-value.primary {
      color: var(--accent);
    }

    .stat-value.success {
      color: var(--accent);
    }

    .parts-container {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 6px;
      overflow: hidden;
    }

    .parts-header {
      background: var(--bg-tertiary);
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
      font-weight: 600;
      color: var(--accent);
    }

    .parts-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    .parts-table th {
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      font-weight: 600;
      text-align: left;
      padding: 10px 8px;
      border-bottom: 1px solid var(--border);
    }

    .parts-table td {
      padding: 10px 8px;
      border-bottom: 1px solid var(--border);
    }

    .part-description {
      max-width: 250px;
    }

    .part-number {
      font-family: monospace;
      font-size: 0.8rem;
      color: var(--text-secondary);
      background: var(--bg-tertiary);
      padding: 3px 6px;
      border-radius: 3px;
      border: 1px solid var(--border);
    }

    .input-field {
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 3px;
      padding: 5px;
      color: var(--text-primary);
      width: 60px;
      text-align: center;
    }

    .input-field:focus {
      outline: none;
      border-color: var(--accent);
    }

    .checkbox-container {
      display: flex;
      justify-content: center;
    }

    .modern-checkbox {
      width: 18px;
      height: 18px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 3px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .modern-checkbox.checked {
      background: var(--accent);
      border-color: var(--accent-dark);
    }

    .modern-checkbox.checked::after {
      content: "âœ“";
      color: white;
      font-size: 12px;
    }

    .refund-value {
      font-weight: 600;
      color: var(--accent);
    }

    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-secondary);
    }

    .empty-state i {
      font-size: 2rem;
      margin-bottom: 10px;
      display: block;
    }

    @media (max-width: 1200px) {
      .main-layout {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .parts-table {
        font-size: 0.8rem;
      }
      
      .parts-table th, 
      .parts-table td {
        padding: 8px 4px;
      }
      
      .input-field {
        width: 50px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Detroit Axle Kit Calculator</h1>
      <p>Calculate refunds for kit components</p>
    </div>

    <div class="main-layout">
      <div class="panel">
        <h2 class="panel-title">Kit Components</h2>
        
        <div class="form-group">
          <label class="form-label">Component List</label>
          <textarea 
            id="kitInput" 
            class="kit-textarea" 
            placeholder="Example:&#10;2x Front Brake Rotors - ABC123&#10;1x Brake Pad Set (Pair) - DEF456&#10;4x Wheel Bolts - GHI789&#10;&#10;Paste your kit components here..."
          ></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Total Kit Price</label>
          <div class="price-input-wrapper">
            <span class="price-icon">$</span>
            <input 
              type="number" 
              id="kitPrice" 
              class="price-input" 
              placeholder="Enter total kit price"
              step="0.01"
              min="0"
            >
          </div>
        </div>
      </div>

      <div class="panel">
        <h2 class="panel-title">Summary</h2>
        
        <div class="stats-grid">
          <div class="stat-item">
            <div class="stat-label">Total Parts</div>
            <div class="stat-value" id="totalParts">0</div>
          </div>
          
          <div class="stat-item">
            <div class="stat-label">Kit Value</div>
            <div class="stat-value primary" id="kitValue">$0.00</div>
          </div>
          
          <div class="stat-item">
            <div class="stat-label">Total Refund</div>
            <div class="stat-value success" id="totalRefund">$0.00</div>
          </div>
        </div>
      </div>
    </div>

    <div class="parts-container" id="partsContainer">
      <div class="empty-state">
        <i>ðŸ“¦</i>
        <p>Paste your kit component list to begin</p>
      </div>
    </div>
  </div>

  <script>
    class KitCalculator {
      constructor() {
        this.parts = [];
        this.knownSingleItems = ["brake pads", "brake rotors", "brake pad", "rotor", "pads"];
        this.init();
      }

      init() {
        this.bindEvents();
        this.updateSummary();
      }

      bindEvents() {
        const kitInput = document.getElementById("kitInput");
        const kitPrice = document.getElementById("kitPrice");

        kitInput.addEventListener("input", this.debounce(() => this.processInput(), 300));
        kitPrice.addEventListener("input", this.debounce(() => this.calculateRefunds(), 200));
      }

      debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      normalizeQuantity(description, quantity) {
        const descLower = description.toLowerCase();
        if (this.knownSingleItems.some(item => descLower.includes(item))) {
          return 1;
        }
        if (descLower.includes("(pair)") && quantity === 1) {
          return 2;
        }
        return quantity;
      }

      processInput() {
        const input = document.getElementById("kitInput").value.trim();
        
        if (!input) {
          this.parts = [];
          this.renderEmptyState();
          this.updateSummary();
          return;
        }

        const lines = input.split(/\n+/).filter(line => line.trim());
        this.parts = [];

        const lineRegex = /^(\d+)x?\s+(.*?)\s*(?:-\s*([A-Z0-9-]+))?$/i;
        
        lines.forEach(line => {
          const trimmedLine = line.trim();
          if (!trimmedLine) return;
          
          const match = lineRegex.exec(trimmedLine);
          if (match) {
            let qty = parseInt(match[1]);
            let desc = match[2].trim();
            let partNum = match[3] || "";
            
            qty = this.normalizeQuantity(desc, qty);
            this.parts.push({ 
              qty, 
              desc, 
              partNum, 
              price: 0, 
              returned: 0,
              isReturned: false
            });
          }
        });

        if (this.parts.length > 0) {
          this.renderTable();
        } else {
          this.renderEmptyState();
        }
        
        this.updateSummary();
      }

      renderEmptyState() {
        document.getElementById("partsContainer").innerHTML = `
          <div class="empty-state">
            <i>ðŸ“¦</i>
            <p>Paste your kit component list to begin</p>
          </div>
        `;
      }

      renderTable() {
        let tableHTML = `
          <div class="parts-header">Parts Breakdown</div>
          <table class="parts-table">
            <thead>
              <tr>
                <th>Qty</th>
                <th>Description</th>
                <th>Part #</th>
                <th>Unit Price</th>
                <th>Returned</th>
                <th>Refund</th>
                <th>Return All</th>
              </tr>
            </thead>
            <tbody>
        `;

        this.parts.forEach((part, index) => {
          tableHTML += `
            <tr>
              <td>
                <input type="number" class="input-field" value="${part.qty}" 
                       onchange="calculator.updatePart(${index}, 'qty', this.value)" min="0">
              </td>
              <td class="part-description">${part.desc}</td>
              <td>
                ${part.partNum ? `<span class="part-number">${part.partNum}</span>` : 'â€”'}
              </td>
              <td>
                <input type="number" class="input-field" placeholder="0.00" 
                       onchange="calculator.updatePart(${index}, 'price', this.value)" 
                       step="0.01" min="0">
              </td>
              <td>
                <input type="number" class="input-field" value="${part.returned}" 
                       onchange="calculator.updatePart(${index}, 'returned', this.value)" 
                       min="0" max="${part.qty}">
              </td>
              <td class="refund-value" id="refund-${index}">$0.00</td>
              <td>
                <div class="checkbox-container">
                  <div class="modern-checkbox ${part.isReturned ? 'checked' : ''}" 
                       onclick="calculator.toggleReturn(${index})"></div>
                </div>
              </td>
            </tr>
          `;
        });

        tableHTML += `</tbody></table>`;
        document.getElementById("partsContainer").innerHTML = tableHTML;
        this.calculateRefunds();
      }

      updatePart(index, field, value) {
        const numValue = parseFloat(value) || 0;
        this.parts[index][field] = numValue;
        
        if (field === 'returned') {
          const maxReturned = this.parts[index].qty;
          if (numValue > maxReturned) {
            this.parts[index].returned = maxReturned;
            event.target.value = maxReturned;
          }
        }
        
        this.calculateRefunds();
      }

      toggleReturn(index) {
        const checkbox = event.target;
        
        if (this.parts[index].isReturned) {
          this.parts[index].returned = 0;
          this.parts[index].isReturned = false;
          checkbox.classList.remove('checked');
          
          // Update the returned input field
          const row = checkbox.closest('tr');
          const returnedInput = row.querySelector('input[type="number"]:nth-of-type(2)');
          returnedInput.value = 0;
        } else {
          const qty = this.parts[index].qty;
          this.parts[index].returned = qty;
          this.parts[index].isReturned = true;
          checkbox.classList.add('checked');
          
          // Update the returned input field
          const row = checkbox.closest('tr');
          const returnedInput = row.querySelector('input[type="number"]:nth-of-type(2)');
          returnedInput.value = qty;
        }
        
        this.calculateRefunds();
      }

      calculateRefunds() {
        if (this.parts.length === 0) return;

        const totalUndiscounted = this.parts.reduce((sum, p) => sum + (p.qty * p.price), 0);
        const kitPrice = parseFloat(document.getElementById("kitPrice").value) || totalUndiscounted;
        const discountFactor = totalUndiscounted > 0 ? (kitPrice / totalUndiscounted) : 1;

        let totalRefund = 0;

        this.parts.forEach((part, index) => {
          const discountedPrice = part.price * discountFactor;
          const refund = Math.min(part.returned, part.qty) * discountedPrice;
          totalRefund += refund;
          
          const refundElement = document.getElementById(`refund-${index}`);
          if (refundElement) {
            refundElement.textContent = `$${refund.toFixed(2)}`;
          }
        });

        this.updateSummary(totalRefund, kitPrice);
      }

      updateSummary(totalRefund = 0, kitValue = 0) {
        document.getElementById("totalParts").textContent = this.parts.length;
        document.getElementById("kitValue").textContent = `$${kitValue.toFixed(2)}`;
        document.getElementById("totalRefund").textContent = `$${totalRefund.toFixed(2)}`;
      }
    }

    // Initialize the calculator
    const calculator = new KitCalculator();
  </script>
</body>
</html>
